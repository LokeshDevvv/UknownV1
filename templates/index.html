<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhishEvil - URL Analysis</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Bootstrap JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .risk-high { color: #dc3545; }
        .risk-medium { color: #ffc107; }
        .risk-low { color: #198754; }
        .score-gauge {
            width: 200px;
            height: 100px;
            margin: 20px auto;
            position: relative;
        }
        .score-value {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .result-card {
            display: none;
            margin-top: 20px;
        }
        .url-input {
            min-height: 150px;
        }
        .results-container {
            max-height: 70vh;
            overflow-y: auto;
        }
        .url-card {
            margin-bottom: 1rem;
            border-left: 5px solid;
        }
        .url-card.high-risk {
            border-left-color: #dc3545;
        }
        .url-card.medium-risk {
            border-left-color: #ffc107;
        }
        .url-card.low-risk {
            border-left-color: #198754;
        }
        .warning-modal .modal-content {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 12px;
        }
        .warning-modal .modal-header {
            border-bottom: none;
            padding: 1.5rem;
            text-align: center;
            display: block;
        }
        .warning-modal .modal-body {
            padding: 1.5rem;
            text-align: center;
        }
        .warning-modal .modal-footer {
            border-top: none;
            justify-content: center;
            padding: 1.5rem;
            gap: 1rem;
        }
        .warning-modal .warning-icon {
            font-size: 64px;
            margin-bottom: 1rem;
        }
        .warning-modal .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-top: 1rem;
        }
        .warning-modal .url-display {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            word-break: break-all;
            font-family: monospace;
        }
        .warning-modal .btn-back {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        .warning-modal .btn-back:hover {
            background: rgba(255,255,255,0.3);
        }
        .warning-modal .btn-proceed {
            background: white;
            color: #dc3545;
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        .warning-modal .btn-proceed:hover {
            background: rgba(255,255,255,0.9);
        }
        .warning-modal .material-icons {
            vertical-align: middle;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">PhishEvil URL Analyzer</h1>
        
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow">
                    <div class="card-body">
                        <form id="urlForm" class="mb-4">
                            <div class="form-group mb-3">
                                <label for="urlInput" class="form-label">Enter URLs (one per line)</label>
                                <textarea class="form-control url-input" id="urlInput" 
                                    placeholder="https://example1.com&#10;https://example2.com&#10;https://example3.com"
                                    required></textarea>
                                <div class="form-text">You can analyze multiple URLs at once. Enter each URL on a new line.</div>
                            </div>
                            <div class="text-center">
                                <button class="btn btn-primary btn-lg" type="submit">Analyze URLs</button>
                            </div>
                        </form>

                        <div id="loading" class="loading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Analyzing URLs...</p>
                        </div>

                        <div id="resultsContainer" class="results-container">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="modal warning-modal fade" id="warningModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="material-icons warning-icon">warning</span>
                    <h5 class="modal-title">Warning: Potential Phishing Site Detected</h5>
                </div>
                <div class="modal-body">
                    <div class="url-display" id="warningUrl"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-back" id="btnGoBack">
                        <span class="material-icons">arrow_back</span>
                        Go Back
                    </button>
                    <button type="button" class="btn btn-proceed" id="btnProceed">
                        <span class="material-icons">warning</span>
                        Proceed Anyway
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPhishingUrl = '';

        function showWarningModal(url) {
            currentPhishingUrl = url;
            document.getElementById('warningUrl').textContent = url;
            const warningModal = new bootstrap.Modal(document.getElementById('warningModal'));
            warningModal.show();
        }

        document.getElementById('btnGoBack').addEventListener('click', () => {
            history.back();
        });

        document.getElementById('btnProceed').addEventListener('click', () => {
            window.location.href = currentPhishingUrl;
        });

        document.getElementById('urlForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const urlsText = document.getElementById('urlInput').value;
            const urls = urlsText.split('\n').filter(url => url.trim() !== '');
            
            if (urls.length === 0) {
                alert('Please enter at least one URL');
                return;
            }

            const loading = document.getElementById('loading');
            const resultsContainer = document.getElementById('resultsContainer');

            // Show loading, clear previous results
            loading.style.display = 'block';
            resultsContainer.innerHTML = '';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ urls: urls })
                });

                const results = await response.json();

                // Process each result
                results.forEach(data => {
                    const riskClass = 
                        data.risk_level === 'High Risk' ? 'high-risk' :
                        data.risk_level === 'Medium Risk' ? 'medium-risk' : 'low-risk';

                    const riskColor = 
                        data.risk_level === 'High Risk' ? 'risk-high' :
                        data.risk_level === 'Medium Risk' ? 'risk-medium' : 'risk-low';

                    const resultHtml = `
                        <div class="card url-card ${riskClass} mb-3">
                            <div class="card-body">
                                <h5 class="card-title">${data.url}</h5>
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3 class="${riskColor}">
                                        <span class="material-icons align-middle me-2">
                                            ${data.risk_level === 'High Risk' ? 'warning' : 
                                              data.risk_level === 'Medium Risk' ? 'info' : 'check_circle'}
                                        </span>
                                        ${data.risk_level}
                                    </h3>
                                    <h4 class="${riskColor}">Score: ${Math.round(data.total_score)}</h4>
                                </div>
                                <div class="text-center mt-3">
                                    ${data.risk_level === 'High Risk' ? 
                                        `<button class="btn btn-danger btn-lg" onclick="showWarningModal('${data.url}')">
                                            <span class="material-icons">warning</span>
                                            Visit Site (Potentially Dangerous)
                                        </button>` :
                                        `<a href="${data.url}" class="btn btn-primary btn-lg" target="_blank">
                                            <span class="material-icons">open_in_new</span>
                                            Visit Site
                                        </a>`
                                    }
                                </div>
                            </div>
                        </div>
                    `;

                    resultsContainer.insertAdjacentHTML('beforeend', resultHtml);
                });

                // Hide loading
                loading.style.display = 'none';
                resultsContainer.style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                alert('Error analyzing URLs. Please try again.');
                loading.style.display = 'none';
            }
        });
    </script>
</body>
</html> 